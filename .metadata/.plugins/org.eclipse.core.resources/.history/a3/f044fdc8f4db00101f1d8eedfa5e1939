#include <stdint.h>
#include <stm32f446xx.h>
#include "main.h"
#include "gpio.h"

void GPIO_Init(void){
	/* Clock Init */
	RCC->AHB1ENR |= RCC_AHB1ENR_GPIOAEN | RCC_AHB1ENR_GPIOCEN;

	/* GPIO Init */
	GPIOA->MODER |= OUTPUT_MODE <<10;		// PA5 Output LED
	GPIOC->MODER |= INPUT_MODE	<< 26;		// PC13 Input Push-Button

	/*SPI1 init*/

    GPIOA->MODER &= ~((3U << 10) | (3U << 12) | (3U << 14)); //mode alternate
    GPIOA->MODER |=  ((2U << 10) | (2U << 12) | (2U << 14));

    GPIOA->AFR[0] &= ~((0xF << 20) | (0xF << 24) | (0xF << 28)); //spi1
    GPIOA->AFR[0] |=  ((5U  << 20) | (5U  << 24) | (5U  << 28));

    GPIOA->OTYPER &= ~((1U << 6) | (1U << 7));

    SPI1->CR1 = SPI_CR1_MSTR       // Mode master
              | SPI_CR1_SSM        // NSS logiciel activé
              | SPI_CR1_SSI        // NSS interne à 1 (valide le master)
              | SPI_CR1_BR_1       // Baudrate prescaler fPCLK/16
              | SPI_CR1_SPE;       // Activation du SPI


}


void GPIO_SetPin(GPIO_TypeDef* GPIO, uint16_t pin){
	GPIO->ODR |= 1 << pin ;
}

void GPIO_ResetPin(GPIO_TypeDef* GPIO, uint16_t pin){
	GPIO->ODR &= ~(1 << pin) ;
}

void GPIO_TogglePin(GPIO_TypeDef* GPIO, uint16_t pin){
	GPIO->ODR ^= 1 << pin ;
}

uint16_t GPIO_ReadPin(GPIO_TypeDef* GPIO, uint16_t pin){
	if((GPIO->IDR & (1 << pin)) !=0)	return 1;
	else 								return 0;
}
